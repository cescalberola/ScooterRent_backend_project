const { Review,Customer, Sequelize } = require('../models/index.js');
const { Op } = Sequelize;

const ReviewController = {
    create(req, res) {
        Review.create({...req.body,CustomerId:req.customer.id})
            .then(review => res.status(201).send({ message: 'Review created succesfully', review }))
            .catch ((err)=>{
                console.error(err)
                res.status(500).send({msg: "There has been an error",err})
            });
    },
    getAll(req, res) {
        Review.findAll({
                include: [{model: Customer, attributes: ['email', 'Firstname']}]
            })
            .then(reviews => res.send(reviews))
            .catch(err => {
                console.error(err)
                res.status(500).send({ message: 'There was a problem loading publications' })
            })
    },

    getById(req, res) {
        Review.findByPk(req.params.id, {
                include: [Customer]
            })
            .then(post => res.send(post))
    },

    getOneByName(req, res) {
        Review.findOne({
                where: {
                    title: {
                        [Op.like]: `%${req.params.title}%`
                    }
                },
                include: [Customer]
            })
            .then(post => res.send(post))
    },

    async delete(req, res) {
        try {
            await Review.destroy({
                where: {
                    id: req.params.id
                }
            });
            res.send('The review has been successfully removed');
        }catch (error){
            console.error(error);
    }
    },





}

module.exports = ReviewController